# Composer
## Installing Drupal 8
The Drupal Composer [template](https://github.com/drupal-composer/drupal-project) is a great way to start a new Drupal 8 project. A new site can be installed with the following command:

```
composer create-project drupal-composer/drupal-project:8.x-dev drupal --stability dev --no-interaction
```

This template will create a `drupal` folder, which contains a few notable elements:

* `composer.json` - This is the heart of your project and where all dependencies are managed.
* `vendor` - This is the folder generated by composer to store most of the dependencies.
* `web` - This is the public folder for your site and where Drupal lives. Composer would've added Drupal core files to `web/core` and contrib modules to `web/modules/contrib`.

There are two contrib modules added be default to this template, they are `devel` and `token`.

## Adding a contrib module
Update the project's composer.json with the contrib module and version within the `require` section. Until contrib modules start making their way onto [Packagist](http://www.packagist.org) there is a [Drupal version](https://packagist.drupal-composer.org/) that can be used. For this to work you will also need to make sure the `repositories` section of composer.json has the follow:

```
    "repositories": [
        {
            "type": "composer",
            "url": "https://packagist.drupal-composer.org"
        }
    ],
```

## Patching contrib
You can even patch Drupal contrib modules with composer, infact you can patch any dependency you're requiring in the project. The [composer-patches](https://github.com/cweagans/composer-patches) plugin makes this easy, just require the plugin by adding the project `"cweagans/composer-patches": "~1.0"` to the `require` section of your composer.json.

The `extra` section of the composer.json is there patches are defined by package, for example to patch the Token module you could use the following:

```
"extra": {
        "patches": {
            "drupal/token": {
                "Description for reused fields not correct": "https://www.drupal.org/files/issues/token-Fix_description_for_reused_fields-2497251-5.patch"
            }
        }
      }
```

## Adding a custom module
There are many ways to add custom modules. One would be to specify the repository for the module, then require it:

```
{
    "repositories": [
        {
            "type": "vcs",
            "url": "https://github.com/awesome-modules/module-one"
        }
    ],
    "require": {
        "awesome-modules/module-one": "~8.1.0"
    }
}
```

This would also handle private repos, as long as the user running the composer commands has access to the repo, composer will pull it down.

Another way would be setup a system like [Toran Proxy](https://toranproxy.com/). This is esspecially good if there are a large number of custom modules or if there are nested dependencies of custom modules.

```
    "repositories": [
        {"type": "composer", "url": "http://toran.example.com/repo/private/"},
        {"type": "composer", "url": "http://toran.example.com/repo/packagist/"},
    ]
```

Here we have to repositories for our Toran Proxy, one for private repos and one for a proxy to Packagist. Accessing Toran Proxy via a browser allows custom module repos to be added. Any of these projects can then be required in the normal way.

## Adding dependencies to your custom module
A custom module should also have a composer.json, for example:

```
{
    "name": "drupal/examples",
    "description": "The Examples for Developers project aims to provide high-quality, well-documented API examples for a broad range of Drupal core functionality.",
    "type": "drupal-module",
    "license": "GPL-2.0+"
}
```

This can then have a `require` section to denote any dependencies. These will then get pulled in as part of the overall project when `composer install` or `composer update` is run.